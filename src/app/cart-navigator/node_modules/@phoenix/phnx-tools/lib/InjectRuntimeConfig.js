"use strict";

function InjectRuntimeConfig(options) {
  options = options || {};
  this.runtimeConfig = options.runtimeConfig || {};
}

InjectRuntimeConfig.prototype.apply = function (compiler) {
  var self = this;
  compiler.hooks.compilation.tap('InjectRuntimeConfig', function (compilation) {
    compilation.hooks.htmlWebpackPluginAlterAssetTags.tapAsync('InjectRuntimeConfig', function (htmlPluginData, callback) {
      htmlPluginData.head.push({
        tagName: 'script',
        closeTag: true,
        attributes: {
          type: 'text/javascript'
        },
        innerHTML: "/*PHNX_RUNTIME_CONFIG*/\nObject.defineProperty(window, 'runtimeConfig', {value:Object.freeze(".concat(JSON.stringify(self.runtimeConfig, null, 4), "),writable:false});\n/*PHNX_RUNTIME_CONFIG_END*/")
      });
      callback(null, htmlPluginData);
    });
  });
};

module.exports = InjectRuntimeConfig;