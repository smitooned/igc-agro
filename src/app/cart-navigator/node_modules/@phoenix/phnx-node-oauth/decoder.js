/**
 * This file exports the decoder logic so that anyone
 * can import this logic anywhere
 *
 * @author Aftab.Khan
 * @date 23-03-2017
 */
var fs = require('fs');
var path = require('path');
var jwt = require('jwt-simple');

/**
 * Make sure this public.cert is up to date with what you have on the JAVA OAuth server
 * @type {file}
 */
var packageJSON = null;
var publicCert = null;
try {
	packageJSON = require(path.join(process.cwd(), "./package.json"));
	publicCert = fs.readFileSync(path.join(process.cwd(), packageJSON.PhnxOAuth.cert));
} catch(e) {
	throw new Error("Unable to locate the public certificate of the oauth server. Check OAuthCert attr in your package.json");
}

module.exports = function(token) {
	var toReturn = null;
	try {
		if(publicCert) {
			toReturn = jwt.decode(token.replace(/^Bearer\s*/i,""), publicCert, false, "RS256");
		}
	} catch(e) {
		console.log("token decoding failed ", e);
	}
	return toReturn;
};