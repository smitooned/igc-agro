'use strict';

var phnxMaterial = {};

function addRipple(event) {
    var circle;
    if(event.target.tagName=='svg'){
        circle = event.target.firstChild;
        circle.style.fill = window.getComputedStyle(event.target.parentElement).color;
    } else {
        circle = event.target;
        circle.style.fill = window.getComputedStyle(event.target.parentElement.parentElement).color;
    }
    circle.style.animationIterationCount="infinite";
    circle.style.animationDuration = "1s";
    circle.style.animationName = "rippleEffect";
    var boundary = event.target.getBoundingClientRect();
    circle.style.cx=event.x-boundary.left;
    circle.style.cy=event.y-boundary.top;
    circle.style.r = 0;
    circle.classList.add('ripple-active');
}
function removeRipple(event) {
    var circle;
    if(event.target.tagName=='svg'){
        circle = event.target.firstChild;
    } else {
        circle = event.target;
    }
    circle.style.animationIterationCount = 1;
    circle.style.r = window.getComputedStyle(circle).r;
    circle.style.animationDuration = "0.3s";
    circle.style.animationName = "rippleEnd";
}
function phnxInit(ref) {
    if(ref==undefined) {
        var selection = document.querySelectorAll('[data-ripple]');
    } else {
        var selection = ref.querySelectorAll('[data-ripple]');
    }
    for(var i=0;i<selection.length;i++){
        if(selection[i].querySelector('svg[data-enable-ripple="true"]') != null) {
            return;
        }
        var elem = document.createElementNS("http://www.w3.org/2000/svg", "svg");
        elem.dataset.enableRipple=true;
        elem.style.borderRadius='2px';
        selection[i].style.position = selection[i].style.position=='absolute'?'absolute':'relative';
        var circle = document.createElementNS("http://www.w3.org/2000/svg", "circle");
        circle.style.fillOpacity = 0.12;
        elem.appendChild(circle);
        elem.className.baseVal = 'ripple-container';
        elem.addEventListener("mousedown",addRipple);
        elem.addEventListener("mouseup",removeRipple);
        circle.addEventListener("mouseleave",removeRipple);
        circle.addEventListener("contextmenu",removeRipple);
        selection[i].appendChild(elem);
    }
}

phnxMaterial["addRipple"]=addRipple;
phnxMaterial["removeRipple"]=removeRipple;
phnxMaterial["phnxInit"]=phnxInit;

module.exports = phnxMaterial;